apiVersion: 1

contactPoints:
  # 默认联系点
  - orgId: 1
    name: default-contact-point
    receivers:
      - uid: default-email
        type: email
        settings:
          addresses: 'performance-team@example.com'
          singleEmail: false
        disableResolveMessage: false
  
  # 钉钉通知
  - orgId: 1
    name: dingtalk-webhook
    receivers:
      - uid: dingtalk-webhook-1
        type: webhook
        settings:
          url: 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN'
          httpMethod: POST
          maxAlerts: 10
        disableResolveMessage: false
  
  # 企业微信通知
  - orgId: 1
    name: wecom-webhook
    receivers:
      - uid: wecom-webhook-1
        type: webhook
        settings:
          url: 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY'
          httpMethod: POST
          maxAlerts: 10
        disableResolveMessage: false
  
  # Slack通知
  - orgId: 1
    name: slack-webhook
    receivers:
      - uid: slack-webhook-1
        type: slack
        settings:
          url: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'
          recipient: '#performance-alerts'
          username: 'K6 Performance Bot'
        disableResolveMessage: false

# 通知策略
policies:
  - orgId: 1
    receiver: default-contact-point
    group_by: ['alertname', 'severity']
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h
    routes:
      # 严重告警立即通知
      - receiver: dingtalk-webhook
        matchers:
          - severity = critical
        group_wait: 10s
        repeat_interval: 1h
      
      # 警告级别告警
      - receiver: wecom-webhook
        matchers:
          - severity = warning
        group_wait: 30s
        repeat_interval: 2h
      
      # 信息级别告警
      - receiver: slack-webhook
        matchers:
          - severity = info
        group_wait: 1m
        repeat_interval: 6h
